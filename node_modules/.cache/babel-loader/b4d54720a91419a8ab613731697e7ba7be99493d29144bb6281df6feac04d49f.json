{"ast":null,"code":"import{useEffect,useState}from\"react\";import\"@/App.css\";import{BrowserRouter,Routes,Route,Navigate,useNavigate,useLocation}from\"react-router-dom\";import axios from\"axios\";import{Toaster,toast}from\"sonner\";import Landing from\"./pages/Landing\";import Dashboard from\"./pages/Dashboard\";import TechnicianDashboard from\"./pages/TechnicianDashboard\";import AdminDashboard from\"./pages/AdminDashboard\";import Technicians from\"./pages/Technicians\";import Marketplace from\"./pages/Marketplace\";import PaymentSuccess from\"./pages/PaymentSuccess\";import PaymentCancel from\"./pages/PaymentCancel\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=\"\".concat(BACKEND_URL,\"/api\");function App(){const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{handleAuth();},[]);const handleAuth=async()=>{// Check for session_id in URL hash\nconst hash=window.location.hash;if(hash&&hash.includes(\"session_id=\")){const sessionId=hash.split(\"session_id=\")[1].split(\"&\")[0];try{const response=await axios.get(\"\".concat(API,\"/auth/session\"),{headers:{\"X-Session-ID\":sessionId}});// Set session token in cookie\ndocument.cookie=\"session_token=\".concat(response.data.session_token,\"; path=/; max-age=\").concat(7*24*60*60,\"; secure; samesite=none\");// Get user profile\nawait loadUserProfile();// Clean URL\nwindow.history.replaceState({},document.title,window.location.pathname);toast.success(\"Welcome back!\");}catch(error){console.error(\"Auth error:\",error);toast.error(\"Authentication failed\");setLoading(false);}}else{// Check existing session\nawait loadUserProfile();}};const loadUserProfile=async()=>{try{const response=await axios.get(\"\".concat(API,\"/users/me\"),{withCredentials:true});setUser(response.data);}catch(error){console.log(\"Not authenticated\");}finally{setLoading(false);}};const handleLogout=async()=>{try{await axios.post(\"\".concat(API,\"/auth/logout\"),{},{withCredentials:true});document.cookie=\"session_token=; path=/; max-age=0\";setUser(null);toast.success(\"Logged out successfully\");}catch(error){console.error(\"Logout error:\",error);}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"loading-screen\",\"data-testid\":\"loading-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})]});}const getDashboardRoute=()=>{if(!user)return\"/\";if(user.role===\"admin\")return\"/admin/dashboard\";if(user.role===\"technician\")return\"/technician/dashboard\";return\"/dashboard\";};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Toaster,{position:\"top-right\",richColors:true}),/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:user?/*#__PURE__*/_jsx(Navigate,{to:getDashboardRoute()}):/*#__PURE__*/_jsx(Landing,{})}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard\",element:user&&user.role===\"consumer\"?/*#__PURE__*/_jsx(Dashboard,{user:user,onLogout:handleLogout,onUpdateUser:loadUserProfile}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/technician/dashboard\",element:user&&user.role===\"technician\"?/*#__PURE__*/_jsx(TechnicianDashboard,{user:user,onLogout:handleLogout,onUpdateUser:loadUserProfile}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/dashboard\",element:user&&user.role===\"admin\"?/*#__PURE__*/_jsx(AdminDashboard,{user:user,onLogout:handleLogout}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/technicians\",element:user&&user.role===\"consumer\"?/*#__PURE__*/_jsx(Technicians,{user:user,onLogout:handleLogout}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/marketplace\",element:user&&user.role===\"consumer\"?/*#__PURE__*/_jsx(Marketplace,{user:user,onLogout:handleLogout}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/payment/success\",element:user?/*#__PURE__*/_jsx(PaymentSuccess,{user:user,onLogout:handleLogout}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})}),/*#__PURE__*/_jsx(Route,{path:\"/payment/cancel\",element:user?/*#__PURE__*/_jsx(PaymentCancel,{user:user,onLogout:handleLogout}):/*#__PURE__*/_jsx(Navigate,{to:\"/\"})})]})})]});}export default App;","map":{"version":3,"names":["useEffect","useState","BrowserRouter","Routes","Route","Navigate","useNavigate","useLocation","axios","Toaster","toast","Landing","Dashboard","TechnicianDashboard","AdminDashboard","Technicians","Marketplace","PaymentSuccess","PaymentCancel","jsx","_jsx","jsxs","_jsxs","BACKEND_URL","process","env","REACT_APP_BACKEND_URL","API","concat","App","user","setUser","loading","setLoading","handleAuth","hash","window","location","includes","sessionId","split","response","get","headers","document","cookie","data","session_token","loadUserProfile","history","replaceState","title","pathname","success","error","console","withCredentials","log","handleLogout","post","className","children","getDashboardRoute","role","position","richColors","path","element","to","onLogout","onUpdateUser"],"sources":["/Users/sujanbhusal/Downloads/agente/gearupf/src/App.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport \"@/App.css\";\nimport { BrowserRouter, Routes, Route, Navigate, useNavigate, useLocation } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { Toaster, toast } from \"sonner\";\nimport Landing from \"./pages/Landing\";\nimport Dashboard from \"./pages/Dashboard\";\nimport TechnicianDashboard from \"./pages/TechnicianDashboard\";\nimport AdminDashboard from \"./pages/AdminDashboard\";\nimport Technicians from \"./pages/Technicians\";\nimport Marketplace from \"./pages/Marketplace\";\nimport PaymentSuccess from \"./pages/PaymentSuccess\";\nimport PaymentCancel from \"./pages/PaymentCancel\";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nfunction App() {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    handleAuth();\n  }, []);\n\n  const handleAuth = async () => {\n    // Check for session_id in URL hash\n    const hash = window.location.hash;\n    if (hash && hash.includes(\"session_id=\")) {\n      const sessionId = hash.split(\"session_id=\")[1].split(\"&\")[0];\n      \n      try {\n        const response = await axios.get(`${API}/auth/session`, {\n          headers: { \"X-Session-ID\": sessionId }\n        });\n        \n        // Set session token in cookie\n        document.cookie = `session_token=${response.data.session_token}; path=/; max-age=${7 * 24 * 60 * 60}; secure; samesite=none`;\n        \n        // Get user profile\n        await loadUserProfile();\n        \n        // Clean URL\n        window.history.replaceState({}, document.title, window.location.pathname);\n        \n        toast.success(\"Welcome back!\");\n      } catch (error) {\n        console.error(\"Auth error:\", error);\n        toast.error(\"Authentication failed\");\n        setLoading(false);\n      }\n    } else {\n      // Check existing session\n      await loadUserProfile();\n    }\n  };\n\n  const loadUserProfile = async () => {\n    try {\n      const response = await axios.get(`${API}/users/me`, {\n        withCredentials: true\n      });\n      setUser(response.data);\n    } catch (error) {\n      console.log(\"Not authenticated\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await axios.post(`${API}/auth/logout`, {}, { withCredentials: true });\n      document.cookie = \"session_token=; path=/; max-age=0\";\n      setUser(null);\n      toast.success(\"Logged out successfully\");\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"loading-screen\" data-testid=\"loading-screen\">\n        <div className=\"spinner\"></div>\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  const getDashboardRoute = () => {\n    if (!user) return \"/\";\n    if (user.role === \"admin\") return \"/admin/dashboard\";\n    if (user.role === \"technician\") return \"/technician/dashboard\";\n    return \"/dashboard\";\n  };\n\n  return (\n    <div className=\"App\">\n      <Toaster position=\"top-right\" richColors />\n      <BrowserRouter>\n        <Routes>\n          <Route path=\"/\" element={\n            user ? <Navigate to={getDashboardRoute()} /> : <Landing />\n          } />\n          <Route path=\"/dashboard\" element={\n            user && user.role === \"consumer\" ? \n              <Dashboard user={user} onLogout={handleLogout} onUpdateUser={loadUserProfile} /> \n              : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/technician/dashboard\" element={\n            user && user.role === \"technician\" ? \n              <TechnicianDashboard user={user} onLogout={handleLogout} onUpdateUser={loadUserProfile} /> \n              : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/admin/dashboard\" element={\n            user && user.role === \"admin\" ? \n              <AdminDashboard user={user} onLogout={handleLogout} /> \n              : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/technicians\" element={\n            user && user.role === \"consumer\" ? <Technicians user={user} onLogout={handleLogout} /> : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/marketplace\" element={\n            user && user.role === \"consumer\" ? <Marketplace user={user} onLogout={handleLogout} /> : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/payment/success\" element={\n            user ? <PaymentSuccess user={user} onLogout={handleLogout} /> : <Navigate to=\"/\" />\n          } />\n          <Route path=\"/payment/cancel\" element={\n            user ? <PaymentCancel user={user} onLogout={handleLogout} /> : <Navigate to=\"/\" />\n          } />\n        </Routes>\n      </BrowserRouter>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}