{"ast":null,"code":"import{useEffect,useState}from\"react\";import{useNavigate,useSearchParams}from\"react-router-dom\";import axios from\"axios\";import{CheckCircle,Wrench,ArrowRight}from\"lucide-react\";import{Button}from\"@/components/ui/button\";import\"./PaymentSuccess.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=\"\".concat(BACKEND_URL,\"/api\");const PaymentSuccess=_ref=>{let{user}=_ref;const navigate=useNavigate();const[searchParams]=useSearchParams();const[paymentStatus,setPaymentStatus]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const sessionId=searchParams.get(\"session_id\");if(sessionId){checkPaymentStatus(sessionId);}},[searchParams]);const checkPaymentStatus=async sessionId=>{let attempts=0;const maxAttempts=5;const poll=async()=>{try{const response=await axios.get(\"\".concat(API,\"/payments/status/\").concat(sessionId),{withCredentials:true});setPaymentStatus(response.data);if(response.data.payment_status===\"paid\"){setLoading(false);return;}else if(response.data.status===\"expired\"){setLoading(false);return;}attempts++;if(attempts<maxAttempts){setTimeout(poll,2000);}else{setLoading(false);}}catch(error){console.error(\"Payment status error:\",error);setLoading(false);}};poll();};return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-page\",\"data-testid\":\"payment-success-page\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"navbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"navbar-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"navbar-logo\",onClick:()=>navigate(\"/dashboard\"),children:[/*#__PURE__*/_jsx(Wrench,{size:24}),\"GearUp Repairs\"]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-content\",children:loading?/*#__PURE__*/_jsxs(\"div\",{className:\"payment-card\",\"data-testid\":\"payment-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Verifying Payment...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please wait while we confirm your payment\"})]}):(paymentStatus===null||paymentStatus===void 0?void 0:paymentStatus.payment_status)===\"paid\"?/*#__PURE__*/_jsxs(\"div\",{className:\"payment-card success\",\"data-testid\":\"payment-success-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"success-icon\",children:/*#__PURE__*/_jsx(CheckCircle,{size:64})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Payment Successful!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtitle\",children:\"Thank you for your purchase\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Amount Paid:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[\"$\",paymentStatus.amount.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value success-text\",children:paymentStatus.payment_status})]})]}),/*#__PURE__*/_jsxs(Button,{onClick:()=>navigate(\"/dashboard\"),\"data-testid\":\"back-to-dashboard-btn\",children:[\"Back to Dashboard\",/*#__PURE__*/_jsx(ArrowRight,{size:18})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"payment-card error\",\"data-testid\":\"payment-error-content\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Payment Processing\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your payment is being processed. Please check back later.\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate(\"/dashboard\"),children:\"Back to Dashboard\"})]})})]});};export default PaymentSuccess;","map":{"version":3,"names":["useEffect","useState","useNavigate","useSearchParams","axios","CheckCircle","Wrench","ArrowRight","Button","jsx","_jsx","jsxs","_jsxs","BACKEND_URL","process","env","REACT_APP_BACKEND_URL","API","concat","PaymentSuccess","_ref","user","navigate","searchParams","paymentStatus","setPaymentStatus","loading","setLoading","sessionId","get","checkPaymentStatus","attempts","maxAttempts","poll","response","withCredentials","data","payment_status","status","setTimeout","error","console","className","children","onClick","size","amount","toFixed"],"sources":["/Users/sujanbhusal/Downloads/agente/gearupf/src/pages/PaymentSuccess.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { CheckCircle, Wrench, ArrowRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport \"./PaymentSuccess.css\";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nconst PaymentSuccess = ({ user }) => {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const [paymentStatus, setPaymentStatus] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const sessionId = searchParams.get(\"session_id\");\n    if (sessionId) {\n      checkPaymentStatus(sessionId);\n    }\n  }, [searchParams]);\n\n  const checkPaymentStatus = async (sessionId) => {\n    let attempts = 0;\n    const maxAttempts = 5;\n    \n    const poll = async () => {\n      try {\n        const response = await axios.get(`${API}/payments/status/${sessionId}`, {\n          withCredentials: true\n        });\n        \n        setPaymentStatus(response.data);\n        \n        if (response.data.payment_status === \"paid\") {\n          setLoading(false);\n          return;\n        } else if (response.data.status === \"expired\") {\n          setLoading(false);\n          return;\n        }\n        \n        attempts++;\n        if (attempts < maxAttempts) {\n          setTimeout(poll, 2000);\n        } else {\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error(\"Payment status error:\", error);\n        setLoading(false);\n      }\n    };\n    \n    poll();\n  };\n\n  return (\n    <div className=\"payment-page\" data-testid=\"payment-success-page\">\n      <nav className=\"navbar\">\n        <div className=\"navbar-container\">\n          <div className=\"navbar-logo\" onClick={() => navigate(\"/dashboard\")}>\n            <Wrench size={24} />\n            GearUp Repairs\n          </div>\n        </div>\n      </nav>\n\n      <div className=\"payment-content\">\n        {loading ? (\n          <div className=\"payment-card\" data-testid=\"payment-loading\">\n            <div className=\"spinner\"></div>\n            <h2>Verifying Payment...</h2>\n            <p>Please wait while we confirm your payment</p>\n          </div>\n        ) : paymentStatus?.payment_status === \"paid\" ? (\n          <div className=\"payment-card success\" data-testid=\"payment-success-content\">\n            <div className=\"success-icon\">\n              <CheckCircle size={64} />\n            </div>\n            <h1>Payment Successful!</h1>\n            <p className=\"subtitle\">Thank you for your purchase</p>\n            <div className=\"payment-details\">\n              <div className=\"detail-item\">\n                <span className=\"label\">Amount Paid:</span>\n                <span className=\"value\">${paymentStatus.amount.toFixed(2)}</span>\n              </div>\n              <div className=\"detail-item\">\n                <span className=\"label\">Status:</span>\n                <span className=\"value success-text\">{paymentStatus.payment_status}</span>\n              </div>\n            </div>\n            <Button onClick={() => navigate(\"/dashboard\")} data-testid=\"back-to-dashboard-btn\">\n              Back to Dashboard\n              <ArrowRight size={18} />\n            </Button>\n          </div>\n        ) : (\n          <div className=\"payment-card error\" data-testid=\"payment-error-content\">\n            <h1>Payment Processing</h1>\n            <p>Your payment is being processed. Please check back later.</p>\n            <Button onClick={() => navigate(\"/dashboard\")}>Back to Dashboard</Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default PaymentSuccess;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}